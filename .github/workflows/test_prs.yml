name: HANDLE_PR

on:
  pull_request:
    types: [opened, synchronize]
    branches: [ dev, test, master ]

jobs:
  file_changes:
    name: Check if the PR made changes to client or server (or both!)
    runs-on: ubuntu-latest
    outputs:
      client: ${{ steps.filter.outputs.client }}
      server: ${{ steps.filter.outputs.server }}
    steps:
    - uses: dorny/paths-filter@master
      id: filter
      with:
        # Filters stored in own yaml file or inline yml
        #filters: '.github/labeler.yml'
          filters: |
           server:
            - 'server/**/*'
           client:
            - 'client/**/*'
  auto-label:
    name: Label client/server
    runs-on: ubuntu-latest
    steps:
      - uses: actions/labeler@master
        with:
            repo-token: "${{ secrets.GITHUB_TOKEN }}"
      - name: Dump GitHub context for DEBUG
        env:
          GITHUB_CONTEXT: ${{ toJson(github) }}
        run: echo "$GITHUB_CONTEXT"
  test-client:
    needs: [file_changes]
    name: Run tests on client 
    if: ${{ needs.file_changes.outputs.client == 'true' }}
    runs-on: ubuntu-latest
    steps:
      - name: Installing Dependencies
        run:  npm install
        working-directory: ./client
      - name: Running tests
        run: npm test
        working-directory: ./client
  test-server:
    needs: [file_changes]
    name: Run tests on Server 
    if: ${{ needs.file_changes.outputs.server == 'true' }}
    runs-on: ubuntu-latest
    steps:
      - name: Installing Dependencies
        run:  npm install
        working-directory: ./server
      - name: Running tests
        run: npm test
        working-directory: ./server
