CREATE OR REPLACE FUNCTION public.create_event(curr_investigation integer DEFAULT NULL::integer,
                                               user_allows_hamagen_data boolean DEFAULT NULL::boolean,
                                               event_start_time timestamp without time zone DEFAULT NULL::timestamp without time zone,
                                               event_end_time timestamp without time zone DEFAULT NULL::timestamp without time zone,
                                               event_place_name character varying DEFAULT NULL::character varying,
                                               event_place_type character varying DEFAULT NULL::character varying,
                                               event_bus_line integer DEFAULT NULL::integer,
                                               event_train_line character varying DEFAULT NULL::character varying,
                                               event_bus_company character varying DEFAULT NULL::character varying,
                                               event_boarding_station character varying DEFAULT NULL::character varying,
                                               event_end_station character varying DEFAULT NULL::character varying,
                                               event_number_of_contacted integer DEFAULT NULL::integer,
                                               event_isolation_start_date timestamp without time zone DEFAULT NULL::timestamp without time zone,
                                               is_externalized boolean DEFAULT NULL::boolean,
                                               event_grade character varying DEFAULT NULL::character varying,
                                               flight_origin character varying DEFAULT NULL::character varying,
                                               event_flight_detination character varying DEFAULT NULL::character varying,
                                               event_airline character varying DEFAULT NULL::character varying,
                                               event_flight_num character varying DEFAULT NULL::character varying,
                                               event_flight_date timestamp without time zone DEFAULT NULL::timestamp without time zone,
                                               event_contact_phone_number character varying DEFAULT NULL::character varying,
                                               event_contact_person_phone_number character varying DEFAULT NULL::character varying,
                                               event_contact_person_first_name character varying DEFAULT NULL::character varying,
                                               event_contact_person_last_name character varying DEFAULT NULL::character varying)
 RETURNS integer
 LANGUAGE plpgsql
AS $function$DECLARE
	event_id integer;
BEGIN
	SELECT INTO event_id
	id
	FROM contact_event
	WHERE investigation_id=curr_investigation AND
	start_time=event_start_time AND
	end_time=event_end_time;
	IF event_id IS NULL THEN
	INSERT INTO public.contact_event(investigation_id,
									allows_hamagen_data,
									start_time,
									end_time,
									place_name,
									place_type,
									location_address,
									isolation_start_date,
									externalization_approval,
									contact_person_first_name,
									contact_person_last_name,
									contact_person_phone_number,
									number_of_contacted,
									contact_phone_number,
									grade,
									transportation_type,
									city_origin,
									city_destination,
									boarding_station,
									end_station,
									bus_line,
									bus_company,
									train_line,
									flight_origin,
									flight_destination,
									airline,
									flight_num,
									flight_date)
		VALUES(curr_investigation,
              user_allows_hamagen_data,
              event_start_time,
              event_end_time,
              event_place_name,
              event_place_type,
              curr_event_address,
              event_isolation_start_date,
              event_contact_person_phone_number,
              event_contact_person_first_name,
              event_contact_person_last_name,
              event_contact_phone_number,
              event_bus_line,
              event_train_line,
              event_bus_company,
              event_boarding_station,
              event_end_station,
              event_number_of_contacted,
              is_externalized,
              event_grade,
              flight_origin,
              event_flight_detination,
              event_airline,
              event_flight_num,
              event_flight_date,
              )
		RETURNING id INTO event_id;
	END IF;
	RETURN event_id;
END;$function$
;